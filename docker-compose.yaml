networks:
  traefik:
    external: true
    name: traefik
  web-nmatute:
    internal: true
    name: web-nmatute

services:
  frontend:
    restart: always
    expose: ["3000"]
    build:
      context: ./frontend
      args:
        BACKEND_ORIGIN: "http://backend"
        PUBLIC_MAILTO: contact-me.fable876@passmail.com
    depends_on:
      - backend
    networks:
      - traefik
      - web-nmatute
    deploy:
      resources:
        limits:
          memory: 128m
          cpus: 0.10
        reservations:
          memory: 64m
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.nmatute.rule=Host(`nmatute.com`) || Host(`www.nmatute.com`)"
      - "traefik.http.routers.nmatute.entrypoints=websecure"
      - "traefik.http.routers.nmatute.tls=true"
      - "traefik.http.services.nmatute.loadbalancer.server.port=3000"

  backend:
    restart: always
    expose: ["80"]
    build:
      context: ./backend
    networks:
      - web-nmatute
    volumes:
      - ./data.yaml:/etc/app/data.yaml:ro
    deploy:
      resources:
        limits:
          memory: 128m
          cpus: 0.10
        reservations:
          memory: 64m
